<html>
    <head>
        <style>
            *{
		box-sizing: border-box;
		padding: 0;
			margin: 0;
			outline: none;
		}
		div{
			padding: 0;
			margin: 0;
			outline: none;
		}
		body{
			font-family: Roboto, sans-serif;
			background: #FFFFFF;
			overflow: auto;
			height: 860px;
		}
		.container{
            display: flex;
            justify-content: space-evenly;
	    }
        .app{
            display: flex;
            flex-direction: column;
            background: #f7f9fc;
            box-shadow: 0 35px 55px -20px rgba(0,0,0,0.4);
        }
        .cover {
            position: relative;
            height: 100px;
            overflow: hidden;
        }
        .cover img {
            height: 100%;
            margin-left: 0px;
            width:100%;
            /*box-shadow: -5px 60px 15px 55px rgba(2,7,33,0.4), -5px 60px 35px -55px rgba(0,0,0,0.2);*/
        }
        .cover:after{
            position: absolute;
            content: "";
            width: 100%;
            height: 297px;
            display: inline-block;
            background: transparent;
            top: 0;
            left: 0;
            box-shadow: inset 0 0 185px rgba(2,7,33,0.4);
        }
        .cover .fa{
	position: relative;
	font-size: 38px;
	left: 50%;
	top: 55px;
	color: #f7f9fc;
	margin-left: -15px;
	opacity: 0.9;
}
.cover .title{
	position: absolute;
	width: 100%;
	display: inline-block;
	text-align: center;
	text-transform: uppercase;
	bottom: 0;
	color: #fff;
	font-size: 15px;
	font-weight: 600;
	background: rgba(2,7,33,0.7);
	padding: 10px 0;
	letter-spacing: 0.5px;
	left: 0px;
}
.cover .title .sub-title{
	display: block;
	font-size: 10px;
	font-weight: 300;
	letter-spacing: 1px;
	padding-top: 5px;
}

.fav{
	position: relative;
}
.btn{
	padding: 8px 16px;
	border: none;
	border-radius: 35px;
	margin-top: 2px;
	background: #ff5349;
	color: #fff;
	font-size: 14px;
	font-weight: 500;
	box-shadow: 1px 1px 0 rgba(0,0,0,0.2), 0 16px 15px -16px #d24c0f, inset 0 0 25px rgba(0,0,0,0.05);
}
.fav .fa{
	font-size: 14px;
	padding-right: 5px;
}
.fav .users{
	position: relative;
	margin-top: 2px;
	margin-right: 40px;
	float: right;
	z-index: 99999;
}
.fav .users img{
	position: relative;
	width: 29px;
	border: 2px solid rgba(255,83,73,0.9);
	border-radius: 100%;
	margin-left: -15px;
	height: 30px;
}

.fav .users span.fav-count{
	position:absolute;
	width: 29px;
	height: 29px;
	border: 2px solid #fff;
	background: rgba(255,83,73,0.95);
	display: inline-block;
	border-radius: 100%;
	line-height: 32px;
	text-align: center;
	top: 0;
	margin-left: 55px;
	color: #fff;
	font-size: 11px;
}
.user-1{
	z-index: 99;
}
.user-2{
	z-index: 98;
}
.fav:before, .fav:after{
	content: "";
	width: 100%;
	height: 100%;
	display: inline-block;
	clear: both;
}

.story{
	width: 90%;
	height: auto;
    border-radius: 10px;
	background: #fff;
	margin: 25px auto;
	padding: 10px 0;
	border: 1px solid rgba(0,0,0,0.03);
	box-shadow: 0 10px 15px -1px rgba(0,0,0,0.1);
}
.story .title{
	position: absolute;
	margin-top: -35px;
	font-size: 16px;
	font-weight: 600;
	color: rgba(0,0,0,0.5);
}
.story div{
	display: inline-block;
}
.story .story-icon{
	width: 20%;
	text-align: center;
}
.story .story-icon .fa{
	position: relative;
	font-size: 10px;
	top: -28px;
	padding: 5px 12px 5px 14px;
	color: #ff5349;
	border:3px solid #ff5349;
	border-radius: 7px;
	opacity: 0.7;
}
.story .story-icon:after{
	content: "";
    width: 0;
    height: 0;
    display: inline-block;
    position: absolute;
    border-left: 7px solid transparent;
    border-right: 7px solid transparent;
    border-top: 7px solid #ff5349;
    margin-left: -26px;
    margin-top: -4px;
    opacity: 0.7;
}
.story .story-text{
	width: 70%;
	padding: 0 5%;
	font-size: 12px;
	color: rgba(0,0,0,0.3);
	font-weight: 600;
	line-height: 16px;
}

.schedule{
	display:flex;
	flex-direction:column;
	width: 90%;
	height: auto;
	background: #fff;
	margin: 20px auto;
	border: 1px solid rgba(0,0,0,0.03);
	box-shadow: 0 10px 15px -1px rgba(0,0,0,0.1);
}
.schedule> .title{
	position: absolute;
	font-size: 16px;
	margin-top: -35px;
	font-weight: 600;
	color: rgba(0,0,0,0.5);
}
.detail{
	display: flex;
    flex-direction: row;
	justify-content: space-between;
}
.detail .date{
	padding: 8px 5px;
    display: inline-block;
    background: #4f5393;
    color: #fff;
    font-size: 14px;
	letter-spacing: 2px;
    font-weight: 600;
    text-align: center;
    box-shadow: inset 0 -25px 75px -25px rgba(0,0,0,0.4);
}
.detail .date span{
	display: block;
	font-size: 11px;
	text-transform: uppercase;
	font-weight: 400;
	padding-top: 2px;
}
.detail .location{
	position: relative;
	font-size: 14px;
	font-weight: 600;
	display: inline-block;
	padding: 0 10px;
	top: 20px;
	color: rgba(0,0,0,0.6);
}
.detail .location span{
	display: block;
	font-size: 12px;
	color: rgba(0,0,0,0.3);
}
.detail .btn{
	margin-top: 19px;
}
.map-location{
	position: relative;
	height: 105px;
	display: inline-block;
	padding: 21px 0 0px 0;
}
.map-location img{
	width: 87px;
}

.distance{
	position: absolute;
	top: 25px;
	margin-left: 43px;
	font-weight: 600;
	font-size: 11px;
	padding: 5px 10px;
	background: #fff;
	color: rgba(0,0,0,0.5);
	z-index: 99;
	box-shadow: 0 0 3px rgba(0,0,0,0.2);
}
.distance:after{
	content: "";
	display: inline-block;
	position: absolute;
	width: 0;
	height: 0;
	border-left: 7px solid transparent;
	border-right: 7px solid transparent;
	border-top: 7px solid #fff;
	left: 7px;
	margin-top: 18px;
}
.schedule-info{
	font-size: 12px;
    color: rgba(0,0,0,0.3);
}
.schedule-info span{
	display: inline-block;
}
.rows > span{
	width: 40%;
	/*padding: 5px 5%;*/
}
.schedule-info span.info{
	display: block;
}
.schedule-info span .title{
	font-size: 11px;
	font-weight: 600;
	color: rgba(0,0,0,0.3);
	padding-bottom: 5px;
}
.schedule-info span .name,.schedule-info span .time{
	font-size: 14px;
	font-weight: 600;
	color: rgba(0,0,0,0.7);
}
.cover .title span {
    display: block;
    font-size: 10px;
    font-weight: 300;
    letter-spacing: 1px;
    padding-top: 5px;
}
.schedule-info span .row-line{
	font-size: 11px;
	background: #ff5349;
	padding: 4px 8px;
	border-radius: 20px;
	color: #fff;
	font-weight: 500;
	letter-spacing: 1px
}
.schedule-info span .seat-num span{
	font-size: 11px;
	background: #4f5393;
	padding: 5px;
	border-radius: 4px;
	color: #fff;
	font-weight: 500;
}
 .left-arrow, .right-arrow{
				
				position:absolute;
				top: 66%;
				
			}
			 .right-arrow{
				left:auto;
				right:130px;
			}
			.right-arrow:hover{
				cursor:pointer;
			}
			.left-arrow:hover{
				cursor:pointer;
			}
			.arrow{
				display:inline-block;
				border: 3px solid #e01e1e;
				width:16px;
				height:16px;
				border-left:none;
				border-bottom:none;
				margin:auto;
				position:absolute;
				left:0;
				right: 0;
				top:0;
				bottom:0;
			}
			.arrow.arrow-left{
				transform:rotateZ(-135deg);
			}
			 .arrow.arrow-right{
				transform:rotateZ(45deg);
			}
			.rows{
				padding: 7px;
				font-size: 12px;
				color: rgba(0,0,0,0.3);
				font-weight: 600;
				line-height: 16px;
			}
			.schedule {
    position: relative;
    width: 90%;
    height: auto;
    background: #fff;
    margin: 20px auto;
    border: 1px solid rgba(0,0,0,0.03);
    box-shadow: 0 10px 15px -1px rgba(0,0,0,0.1);
}

#dialogoverlay{
    display: none;
    opacity: .8;
    position: fixed;
    top: 0;
    left: 0;
    background: #717171;
    width: 100%;
    z-index: 9999999999;
}
#dialogbox{
    display: none;
    position: fixed;
    border-radius: 7px;
    z-index: 9999999999;
    transform: translate3d(0%, -100%, 0);
    transition: all 0.5s ease-out;
    border-radius: 5px;
    overflow: auto;
}
#dialogbox.animate{
    transform: translate3d(0, 0, 0);
}

            #dialogbox>div{  background: #fff; margin: 8px;}
            #dialogbox>div>#dialogboxhead{background: #92cf48;font-size:19px;padding: 10px;color: #ffffff}
            #dialogbox>div>#dialogboxbody{background:  #5ad20f;padding: 20px; color:  #ffffff;}
            #dialogbox>div>#dialogboxfoot{background: #92cf48;padding:10px;text-align:right;}

#dialogbox div input{
    width: 100%;
    border: none;
    outline: none;
    background: none;
    font-size: 14px;
    color: #fff;
    border-bottom: 1px solid #92cf48;
    padding: 15px 30px;
}
        </style>
    </head>
    <body>
		<div id="movie-list"></div>
		<div id="dialogoverlay"></div>
	        <div id="dialogbox">
	            <div>
	                <div id="dialogboxhead"></div>
	                <div id="dialogboxbody"></div>
	                <div id="dialogboxfoot"></div>
	            </div>
	        </div>
        <script>
			function CustomConfirm() {  
                this.render = function(clickId,dialog,id){
                    if(clickId=="remove-cart-item"){
                        var continueId = id;
                        var html = "<p>Remove this item from your cart</p>";
                        var buttons = '<button class="popup-dialog-button dynamic-content" id='+continueId+' onclick="Confirm.yes(\''+continueId+'\')">Continue</button> <button class="popup-dialog-button" onclick="Confirm.no()">Cancel</button>';
                    }
                    var winWidth = window.innerWidth;
                    var winHeight = window.innerHeight;
                    var dOverlay = document.getElementById("dialogoverlay");
                    var dBox = document.getElementById("dialogbox");
                    dOverlay.style.display = "block";
                    dOverlay.style.height = winHeight+"px";
                    dBox.style.left = (winWidth/2)-(280 * .5)+"px";
                    dBox.style.top = "100px";
                    dBox.style.display = "block";
                    dBox.classList = "animate";
                    document.getElementById("dialogboxhead").innerHTML = dialog;
                    document.getElementById("dialogboxbody").innerHTML = html;
                    document.getElementById("dialogboxfoot").innerHTML = buttons;
                }
                this.no = function(){
                    var dOverlay = document.getElementById("dialogoverlay");
                    var dBox = document.getElementById("dialogbox");
                    dOverlay.style.display = "none";
                    dBox.style.display = "none";

                }
                this.yes = function(id){

                		console.log(id);
                		CART.remove(id)
		                //_("items-number").innerHTML = CART.contents.length;
                        var dOverlay = document.getElementById("dialogoverlay");
                        var dBox = document.getElementById("dialogbox");
                        dOverlay.style.display = "none";
                        dBox.style.display = "none";
                }
        	}
            var Confirm = new CustomConfirm();


            function _(x) { return document.getElementById(x) };
			function hasClass(element, className){
				return element.className.split(" ").indexOf(className) > -1;
			}
			function addClass(element, className){
				if(hasClass(element, className)){
					return element.classList;
				} else {
					return element.classList.add(className);
				}
			}
			function removeClass(element, className){
				if(hasClass(element, className)){
					return element.classList.remove(className);
				}else{
					return element.classList;
				}
			}
            const CART = {
	KEY: 'bjasopticajdbakhadjsk71movies',
	contents: [],
	init() {
		//check localStorage and initialize the contents of CART.contentslet 
		let _contents = localStorage.getItem(CART.KEY); 
		if(_contents) {
			CART.contents = JSON.parse(_contents);
		}else {
			CART.contents = [];
			CART.sync();
		}
	},
	async sync() {
		let _cart = JSON.stringify(CART.contents);
		await localStorage.setItem(CART.KEY, _cart);
	},
	find(id) {
		console.log(id);
		//find an item in the cart by its id
		let match = CART.contents.filter(item => {
			if(item.filmId == id) 
				return true;
		});
		if(match && match[0])
			return match[0];
	},
	addItem(id) {

		if(CART.find(id)) {
			return 0;//CART.increase(id, 1);
			console.log(PAGEPRODUCTS);
		}else{
			let arr = PAGEPRODUCTS.filter(product=> {
				if(product.filmId == id) {
					return true;
				}
			});
			console.log(arr);
		if(arr && arr[0]) {
			let obj = {
				filmId: arr[0].filmId,
				filmName: arr[0].filmName,
				price: arr[0].price,
				imageUrl: arr[0].imageUrl,
				date: arr[0].date,
				description: arr[0].description,
				quantity: 1,
				location: arr[0].location,
			};
			CART.contents.push(obj);
			//update localStorage
			
			CART.sync();
			console.log(CART.contents);
		}else {
			//product id does not exist in products data
			console.error("invalid product");
		}
	}
	},
	filter(array, test){
			var passed = [];
			for(var i = 0; i< array.length; i++){
				if(test(array[i])){
					passed.push(array[i]);
				}
			}
			return passed;
		
	},
	remove(id) {
		//remove an item entirely from CART.contents based on its id 
		CART.contents = CART.filter(CART.contents, (items)=> {
			return items.filmId != id;
		})
		_(id).innerHTML = "Add";
		//update localStorage
		console.log(CART.contents);
		CART.sync();
	},
	empty() {
		//empty whole cart
		CART.contents = [];
		//update localStorage
		CART.sync();
	},
}
            function getAllUrlParams(url){
                var queryString = url ? url.split("?")[1] : window.location.search.splice(1);
                var obj = {}
                if(queryString){
                    queryString = queryString.split("#")[0]
                    var arr = queryString.split("&");

                    for(var i = 0; i<arr.length; i++){
                        var a = arr[i].split("=");
                        var paramName = a[0];

                        var paramValue = typeof(a[1]) === 'undefined' ? true: a[1];

                        paramName = paramName.toLowerCase();
                        if(typeof paramValue === 'string') paramValue = paramValue.toLowerCase()

                        if(paramName.match(/\[(\d+)?\]$/)){
                            var key = paramName.replace(/\[(\d+)?\]/, '');
                            if(! obj[key]) obj[key] = [];

                            if(paramName.match(/\[\d+\]$/)){
                                var index = /\[(\d+)\]/.exec(paramName)[1];

                                obj[key][index]  = paramValue;
                            } else {
                                obj[key].push(paramValue);
                            }
                        }else {
                            if(! obj[paramName]) {
                                obj[paramName] = paramValue;
                            } else if(obj[paramName] && typeof obj[paramName] == 'string'){
                                obj[paramName] = [obj[paramName]];
                                obj[paramName].push(paramValue);
                            } else {
                                obj[paramName].push(paramValue);
                            }
                        }
                    }
                }
                return obj;
            }
            console.log(getAllUrlParams(window.location.href));
            let urldata = getAllUrlParams(window.location.href);
            console.log(urldata);
            var nowshowing = '';
            if(urldata.itemtype=="westlands"){
                nowshowing = [
					{"filmId": "524428f621d601bxz","filmName": "Bad Bots 2","price":400,"imageUrl":"small_Mercedes petronas shirt.jpg", "description":"The robots are back and this time they are meaner than ever can jody stop them this time or will earth fall to the powers of the mighty Bad Bots", "date":"4/3/2020", "location":"Westlands"},
					{"filmId": "5d4428f621d601c11","filmName": "Bad Boys 3","Price":400,"imageUrl":"small_Mercedes petronas shirt.jpg", "description": "Mike and Marcus are back watch them in this action packed thriller that will shurely live you anquered to yous seat", "date":"4/3/2020", "location":"Westlands"},
                    {"filmId": "524428f621d601e2e","filmName": "Dino","price":200,"imageUrl":"small_Mercedes petronas shirt.jpg", "description":"Ever seen a dinosour go wild no you haven't see them today", "date":"4/3/2020", "location":"Westlands"},
					{"filmId": "5d4428f621d601fwe1","filmName": "Misfits","price":600,"imageUrl":"small_Mercedes petronas shirt.jpg", "description": "2 men and a baby go along the most breathtaking mission of their lives", "date":"4/3/2020", "location":"Westlands"}
					]
            }else if(urldata.itemtype=="parklands"){
                nowshowing = [
                    {"filmId": "524428f621d601e12","filmName": "Dino","price":200,"imageUrl":"small_Mercedes petronas shirt.jpg", "description":"Ever seen a dinosour go wild no you haven't see them today", "date":"4/3/2020", "location":"Parklands"},
					{"filmId": "5d4428f621d601f6y","filmName": "Misfits","price":600,"imageUrl":"small_Mercedes petronas shirt.jpg", "description": "2 men and a baby go along the most breathtaking mission of their lives", "date":"4/3/2020", "location":"Parklands"}
					]
            }else if(urldata.itemtype=="kasarani"){
                nowshowing = [
                    {"filmId": "524428f621d601b","filmName": "Bad Bots 2","price":400,"imageUrl":"small_Mercedes petronas shirt.jpg", "description":"The robots are back and this time they are meaner than ever can jody stop them this time or will earth fall to the powers of the mighty Bad Bots","date":"4/3/2020", "location":"Kasarani" },
					{"filmId": "5d4428f621d601c","filmName": "Bad Boys 3","Price":400,"imageUrl":"small_Mercedes petronas shirt.jpg", "description": "Mike and Marcus are back watch them in this action packed thriller that will shurely live you anquered to yous seat", "date":"4/3/2020", "location":"Kasarani"},
                    {"filmId": "524428f621d601e","filmName": "Dino","price":200,"imageUrl":"small_Mercedes petronas shirt.jpg", "description":"Ever seen a dinosour go wild no you haven't see them today", "date":"5/3/2020", "location":"Kasarani"},
					{"filmId": "5d4428f621d601f","filmName": "Misfits","price":600,"imageUrl":"small_Mercedes petronas shirt.jpg", "description": "2 men and a baby go along the most breathtaking mission of their lives", "date":"5/3/2020", "location":"Kasarani"},
                    {"filmId": "5d4428f621d601f","filmName": "Broken Arrow","price":200,"imageUrl":"small_Mercedes petronas shirt.jpg", "description": "When the fate of the world falls into your arms, with warheads and missiles", "date":"10/3/2020", "location":"Kasarani"},
				]
            }
			function getHref(){
				document.querySelector(".view-item").addEventListener("click", function(e) {
					if(hasClass(e.target, "view-item")){
						e.preventDefault();
						var href = e.currentTarget.getAttribute("href")
						console.log(href);	
					}
					e.preventDefault();
					var href = e.currentTarget.getAttribute("href")
					console.log(e.target.getAttribute("data-id"))
					//window.location = href+"?branchid="+urldata.branchid+"&totalprice="+CARTCHECKOUT.totalPrice();
					//window.location = href+"?itemid="+e.target.getAttribute("data-id");
					sendMessage(href, e.target.getAttribute("data-id"));
				})
			}
			let PAGEPRODUCTS = [];
        function showPageProducts(cart) {
			var cartJson = JSON.parse(cart);
			const cartLength = cartJson.length;
			console.log(cartJson);
			//console.log(cartLength);
			console.log(cartLength);
			console.log(nowshowing)
						PAGEPRODUCTS = nowshowing;
					   _("movie-list").innerHTML += PAGEPRODUCTS.map(function(item){
							
								for(var i=0; i<cartLength; i++){
									if(item.filmId == cartJson[i].filmId) {
										return  `
										<div class='schedule'>
											<div class="detail">
												<span class="date go-to-event" >${cartJson[i].date}</span>
												<span class="location">${cartJson[i].filmName}</span>
												<button class='btn view-item' data-id=${cartJson[i].filmId} href="movie.html?movieid="${cartJson[i].filmId}" >View</button>
												<button class="add-to-cart check-status btn" data-id=${cartJson[i].filmId} id=${cartJson[i].filmId}>In Cart</button>
											</div>
											<div class="map-location">
                								<img src="${cartJson[i].imageUrl}" alt="map">
            								</div>
											<div class="schedule-info">
                								<div class="rows">${cartJson[i].description}</div>
            								</div>
										</div>`;
									}
								}	
								return	`
									<div class='schedule'>
										<div class="detail">
											<span class="date go-to-event" >${item.date}</span>
											<span class="location">${item.filmName}</span>
											<button class='btn view-item' data-id=${item.filmId} href="movie.html?movieid="${item.filmId}" >View</button>
											<button class="add-to-cart check-status btn" data-id=${item.filmId} id=${item.filmId}>Add</button>
										</div>
										<div class="map-location">
                							<img src="${item.imageUrl}" alt="map">
            							</div>
										<div class="schedule-info">
                							<div class="rows">${item.description}</div>
            							</div>
									</div>`;
									
								});
		            
		}
		window.onload = function(){
			var incarts = localStorage.getItem(CART.KEY);
        	var incartsJson = JSON.parse(incarts);
			var allButtons = document.getElementsByClassName("button");
			window.addEventListener("click", function(e){
		        if(hasClass(e.target, "check-status")){
		            console.log(e.target.id)
		            if(CART.find(e.target.id)){
		                console.log("item in cart");
		                Confirm.render('remove-cart-item', 'Remove from Cart',e.target.id);
		            }else {
		                console.log("item not in cart");
		                _(e.target.id).innerHTML = "In Cart";
		                CART.addItem(e.target.id, urldata.categoryid);
		               //_("items-number").innerHTML = CART.contents.length;
		                console.log(CART.contents.length);
		            }   
		        }
		    }, false)
		    //get the cart items from localStorage
    		CART.init();

			showPageProducts(incarts);
			getHref();
		}
        </script>

    </body>
</html>