<!DOCTYPE html>
<!-- saved from url=(0055)http://sapandiwakar.in/media-player-basics-for-android/ -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

    <title>Media Player basics for Android</title>
    <meta name="description" content="">

    <link rel="shortcut icon" href="http://sapandiwakar.in/assets/img/favicons/favicon.ico">
    <link rel="apple-touch-icon" sizes="57x57" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://sapandiwakar.in/assets/img/favicons/apple-touch-icon-152x152.png">
    <link rel="icon" type="image/png" href="http://sapandiwakar.in/assets/img/favicons/favicon-196x196.png" sizes="196x196">
    <link rel="icon" type="image/png" href="http://sapandiwakar.in/assets/img/favicons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="http://sapandiwakar.in/assets/img/favicons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="http://sapandiwakar.in/assets/img/favicons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="http://sapandiwakar.in/assets/img/favicons/favicon-32x32.png" sizes="32x32">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/assets/img/favicons/mstile-144x144.png">
    <meta name="msapplication-square70x70logo" content="/assets/img/favicons/mstile-70x70.png">
    <meta name="msapplication-square144x144logo" content="/assets/img/favicons/mstile-144x144.png">
    <meta name="msapplication-square150x150logo" content="/assets/img/favicons/mstile-150x150.png">
    <meta name="msapplication-square310x310logo" content="/assets/img/favicons/mstile-310x310.png">
    <meta name="msapplication-wide310x150logo" content="/assets/img/favicons/mstile-310x150.png">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="./Media Player basics for Android_files/css" rel="stylesheet" type="text/css">
    <link href="./Media Player basics for Android_files/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./Media Player basics for Android_files/screen.css">
    <script type="text/javascript" async="" src="./Media Player basics for Android_files/linkid.js.download"></script><script type="text/javascript" async="" src="./Media Player basics for Android_files/mixpanel-2-latest.min.js.download"></script><script type="text/javascript" async="" src="./Media Player basics for Android_files/analytics.js.download"></script><script type="text/javascript" async="" src="./Media Player basics for Android_files/analytics.min.js.download"></script><script src="./Media Player basics for Android_files/jquery.min.js.download" type="text/javascript"></script>
    <script type="text/javascript" src="./Media Player basics for Android_files/index.js.download"></script>

       
    <script type="text/javascript">
    window.analytics||(window.analytics=[]),window.analytics.methods=["identify","track","trackLink","trackForm","trackClick","trackSubmit","page","pageview","ab","alias","ready","group","on","once","off"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;window.analytics.methods.length>i;i++){var method=window.analytics.methods[i];window.analytics[method]=window.analytics.factory(method)}window.analytics.load=function(t){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)},window.analytics.SNIPPET_VERSION="2.0.8",
    window.analytics.load("q5wtubl6o4");
    window.analytics.page();
    </script>

<style type="text/css">
section.content article section.post-content pre {
  overflow: scroll;
}
</style>

<link rel="canonical" href="http://sapandiwakar.in/media-player-basics-for-android/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    <link rel="amphtml" href="http://sapandiwakar.in/media-player-basics-for-android/amp/">
    
    <meta property="og:site_name" content="Sapan Diwakar">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Media Player basics for Android">
    <meta property="og:description" content="As my previous post about creating Android Music Player was getting a lot of traction, I figured it&#39;s about time to do a rewrite as the previous one is ages old and there have been a lot of improvements and better APIs on Android for supporting music since then. This">
    <meta property="og:url" content="http://sapandiwakar.in/media-player-basics-for-android/">
    <meta property="article:published_time" content="2016-07-19T20:28:00.000Z">
    <meta property="article:modified_time" content="2018-05-15T09:52:43.000Z">
    <meta property="article:tag" content="android">
    <meta property="article:tag" content="music player">
    <meta property="article:tag" content="MediaPlayer">
    <meta property="article:tag" content="audio">
    <meta property="article:tag" content="sound">
    <meta property="article:tag" content="spotify">
    <meta property="article:tag" content="streaming">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Media Player basics for Android">
    <meta name="twitter:description" content="As my previous post about creating Android Music Player was getting a lot of traction, I figured it&#39;s about time to do a rewrite as the previous one is ages old and there have been a lot of improvements and better APIs on Android for supporting music since then. This">
    <meta name="twitter:url" content="http://sapandiwakar.in/media-player-basics-for-android/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Sapan Diwakar">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="android, music player, MediaPlayer, audio, sound, spotify, streaming">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Sapan Diwakar",
        "logo": "http://sapandiwakar.in/content/images/2014/Feb/sapan.png"
    },
    "author": {
        "@type": "Person",
        "name": "Sapan Diwakar",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/3ed0ed63814f37be06e4547362c65f2c?d=404",
            "width": 80,
            "height": 80
        },
        "url": "http://sapandiwakar.in/author/sapan-diwakar/",
        "sameAs": [],
        "description": "Mobile and Web developer. Traveller. "
    },
    "headline": "Media Player basics for Android",
    "url": "http://sapandiwakar.in/media-player-basics-for-android/",
    "datePublished": "2016-07-19T20:28:00.000Z",
    "dateModified": "2018-05-15T09:52:43.000Z",
    "keywords": "android, music player, MediaPlayer, audio, sound, spotify, streaming",
    "description": "As my previous post about creating Android Music Player was getting a lot of traction, I figured it&#x27;s about time to do a rewrite as the previous one is ages old and there have been a lot of improvements and better APIs on Android for supporting music since then. This",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://sapandiwakar.in"
    }
}
    </script>

    <meta name="generator" content="Ghost 0.11">
    <link rel="alternate" type="application/rss+xml" title="Sapan Diwakar" href="http://sapandiwakar.in/rss/">
<style type="text/css">.backpack.dropzone {
  font-family: 'SF UI Display', 'Segoe UI';
  font-size: 15px;
  text-align: center;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  width: 250px;
  height: 150px;
  font-weight: lighter;
  color: white;
  will-change: right;
  z-index: 2147483647;
  bottom: 20%;
  background: #333;
  position: fixed;
  user-select: none;
  transition: left .5s, right .5s;
  right: 0px; }
  .backpack.dropzone .animation {
    height: 80px;
    width: 250px;
    background: url("chrome-extension://lifbcibllhkdhoafpjfnlhfpfgnpldfl/assets/backpack/dropzone/hoverstate.png") left center; }
  .backpack.dropzone .title::before {
    content: 'Save to'; }
  .backpack.dropzone.closed {
    right: -250px; }
  .backpack.dropzone.hover .animation {
    animation: sxt-play-anim-hover 0.91s steps(21);
    animation-fill-mode: forwards;
    background: url("chrome-extension://lifbcibllhkdhoafpjfnlhfpfgnpldfl/assets/backpack/dropzone/hoverstate.png") left center; }

@keyframes sxt-play-anim-hover {
  from {
    background-position: 0px; }
  to {
    background-position: -5250px; } }
  .backpack.dropzone.saving .title::before {
    content: 'Saving to'; }
  .backpack.dropzone.saving .animation {
    background: url("chrome-extension://lifbcibllhkdhoafpjfnlhfpfgnpldfl/assets/backpack/dropzone/saving_loop.png") left center;
    animation: sxt-play-anim-saving steps(59) 2.46s infinite; }

@keyframes sxt-play-anim-saving {
  100% {
    background-position: -14750px; } }
  .backpack.dropzone.saved .title::before {
    content: 'Saved to'; }
  .backpack.dropzone.saved .animation {
    background: url("chrome-extension://lifbcibllhkdhoafpjfnlhfpfgnpldfl/assets/backpack/dropzone/saved.png") left center;
    animation: sxt-play-anim-saved steps(20) 0.83s forwards; }

@keyframes sxt-play-anim-saved {
  100% {
    background-position: -5000px; } }
</style><script type="text/javascript" async="" src="./Media Player basics for Android_files/embed.js.download"></script><link rel="prefetch" as="style" href="https://c.disquscdn.com/next/embed/styles/lounge.9a11b91b20ca66d0cf6475e0f5c1ab1a.css"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/common.bundle.f9554506a08a1cc2b021f0dfc3f59ebb.js"><link rel="prefetch" as="script" href="https://c.disquscdn.com/next/embed/lounge.bundle.2569b4785d87ab13c01fd14df7af10db.js"><link rel="prefetch" as="script" href="https://disqus.com/next/config.js"><script src="./Media Player basics for Android_files/alfalfalfa.0823c767a3bc925f628afd9bed26c958.js.download" async="" charset="UTF-8"></script></head>
<body class="post-template tag-android tag-music-player tag-mediaplayer tag-audio tag-sound tag-spotify tag-streaming" data-gr-c-s-loaded="true" style="">
  <header class="main">
    <h1><a href="http://sapandiwakar.in/">Sapan Diwakar</a></h1>
    <p class="title">Software developer</p>
    <p class="social">
      <a href="https://twitter.com/diwakarsapan" target="_blank"><i class="fa fa-twitter"></i><span>Follow me on <b>Twitter</b></span></a>
      <a href="https://github.com/sapandiwakar" target="_blank"><i class="fa fa-github"></i><span>Check out my code on <b>GitHub</b></span></a>
      <a href="https://stackoverflow.com/users/812269/sapan-diwakar" target="_blank"><i class="fa fa-stack-overflow"></i><span>View some of my designs on <b>Dribbble</b></span></a>
      <a href="https://ch.linkedin.com/in/sapandiwakar/" target="_blank"><i class="fa fa-linkedin"></i><span>Take a look at my <b>Linked In</b> profile</span></a>
    </p>
  </header>
  
  <nav class="main">
    <div class="inner">
      <div class="group pages">
        <ul class="nav">
          <li><i class="icon-blog"></i><a class="blog" href="http://sapandiwakar.in/">Home</a></li>
          <li><i class="icon-about"></i><a class="about" href="http://sapandiwakar.in/about/">About me</a></li>
          <li><i class="icon-projects"></i><a class="projects" href="http://sapandiwakar.in/portfolio/">Things I've done</a></li>
          <li><i class="fa fa-bookmark-o" style="line-height:27px; vertical-align:top; margin-left:2px;"></i><a class="projects" href="mailto:diwakar.sapan@gmail.com">Hire me as a freelancer</a></li>
        </ul>

      </div>
      <div class="group companies">
        <h2>My Companies</h2>
        <ul class="social">
          <li><a href="http://shyahi.com/" target="_blank"><b>Shyahi</b> - Your Social Homepage</a></li>
        </ul>
      </div>
    </div>
  </nav>
  
  <section class="content">
    

<main class="content" role="main">
    <article class="post tag-android tag-music-player tag-mediaplayer tag-audio tag-sound tag-spotify tag-streaming">


        <p class="meta"><time datetime="2016-07-19">Tuesday 19th July 2016</time></p>
        <h1 class="title">Media Player basics for Android</h1>

        <section class="post-content">
            <p>As my previous post about <a href="http://sapandiwakar.in/tutorial-how-to-manually-create-android-media-player-controls/" target="_blank">creating Android Music Player</a> was getting a lot of traction, I figured it's about time to do a rewrite as the previous one is ages old and there have been a lot of improvements and better APIs on Android for supporting music since then. This is going to be the first of a series of post talking about building a full fledged music player app with streaming, custom playlists, offline tracks (basically a boiled down Spotify clone). </p>

<h2 id="mediaplayerbasics">Media Player Basics</h2>

<p>First, let's talk about playing music on the device. The <a href="https://developer.android.com/guide/topics/media/mediaplayer.html" target="_blank">Android multimedia framework</a> includes support for playing variety of common media types, so that you can easily integrate audio, video and images into your applications. You can play audio or video from media files stored in your application's resources (raw resources), from standalone files in the filesystem, or from a data stream arriving over a network connection, all using MediaPlayer APIs.</p>

<h3 id="creatingamediaplayer">Creating a <code>MediaPlayer</code></h3>

<p>One of the most important components of the media framework is the <a href="https://developer.android.com/reference/android/media/MediaPlayer.html" target="_blank">MediaPlayer</a> class. An object of this class can fetch, decode, and play both audio and video with minimal setup. It supports several different media sources such as:</p>

<ul>
<li>Local resources</li>
<li>Internal URIs, such as one you might obtain from a Content Resolver</li>
<li>External URLs (streaming)</li>
</ul>

<p>Here's how you can create a media player  </p>

<pre class=" language-java"><code class=" language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">createMediaPlayerIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mMediaPlayer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MediaPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// Make sure the media player will acquire a wake-lock while</span>
        <span class="token comment" spellcheck="true">// playing. If we don't do that, the CPU might go to sleep while the</span>
        <span class="token comment" spellcheck="true">// song is playing, causing playback to stop.</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">setWakeMode</span><span class="token punctuation">(</span>mService<span class="token punctuation">.</span><span class="token function">getApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> PowerManager<span class="token punctuation">.</span>PARTIAL_WAKE_LOCK<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// we want the media player to notify us when it's ready preparing,</span>
        <span class="token comment" spellcheck="true">// and when it's done playing:</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnPreparedListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnCompletionListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnErrorListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">setOnSeekCompleteListener</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

<h3 id="handlingmediaplayerstates">Handling <code>MediaPlayer</code> states</h3>

<p>MediaPlayer manages the playback control as a <a href="https://developer.android.com/reference/android/media/MediaPlayer.html" target="_blank">state machine</a>. That is, the MediaPlayer has an internal state that you must always be aware of when writing your code, because certain operations are only valid when then player is in specific states. For example, you should only try to play the media after it has finished <code>preparing</code>. This is why we set the <code>OnPreparedListener</code> to get notified when the media player finishes preparing so we can start playback.</p>

<pre class=" language-java"><code class=" language-java"><span class="token comment" spellcheck="true">/**
 * Called when media player is done preparing.
 */</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onPrepared</span><span class="token punctuation">(</span>MediaPlayer player<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token comment" spellcheck="true">// The media player is done preparing. That means we can start playing if we</span>
    <span class="token comment" spellcheck="true">// have audio focus.</span>
    <span class="token function">configMediaPlayerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

<h3 id="handlingnoisyintentandaudiofocus">Handling noisy intent and audio focus</h3>

<p>In order to keep this blog post short and easy to understand, I will keep the more complex features out with a link on how to implement them. Well written apps need to do a bit more than just playing audio. For example, when the user disconnects headphones accidentally, the app should pause the music automatically to prevent playing it out through the speakers. You would need to <a href="https://developer.android.com/guide/topics/media/mediaplayer.html#noisyintent" target="_blank">handle the <code>AUDIO_BECOMING_NOISY</code> Intent</a> to implement this in your app.</p>

<p>Another important thing to remember when building a music app is to <a href="https://developer.android.com/guide/topics/media/mediaplayer.html#audiofocus" target="_blank">correctly handle audio focus</a>. Even though only one activity can run at any given time, Android is a multi-tasking environment. When a user is listening to music and another application needs to notify the user of something very important, the user might not hear the notification tone due to the loud music. When your application needs to output audio such as music or a notification, you should always request audio focus. Once it has focus, it can use the sound output freely, but it should always listen for focus changes. If it is notified that it has lost the audio focus, it should immediately either kill the audio or lower it to a quiet level (known as "ducking"—there is a flag that indicates which one is appropriate) and only resume loud playback after it receives focus again.</p>

<pre class=" language-java"><code class=" language-java"><span class="token comment" spellcheck="true">/**
 * Reconfigures MediaPlayer according to audio focus settings and
 * starts/restarts it. This method starts/restarts the MediaPlayer
 * respecting the current audio focus state. So if we have focus, it will
 * play normally; if we don't have focus, it will either leave the
 * MediaPlayer paused or set it to a low volume, depending on what is
 * allowed by the current focus settings. This method assumes mPlayer !=
 * null, so if you are calling it, you have to do so from a context where
 * you are sure this is the case.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">configMediaPlayerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mAudioFocus <span class="token operator">==</span> AUDIO_NO_FOCUS_NO_DUCK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// If we don't have audio focus and can't duck, we have to pause,</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mState <span class="token operator">==</span> PlaybackState<span class="token punctuation">.</span>STATE_PLAYING<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>  <span class="token comment" spellcheck="true">// we have audio focus:</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mAudioFocus <span class="token operator">==</span> AUDIO_NO_FOCUS_CAN_DUCK<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span>VOLUME_DUCK<span class="token punctuation">,</span> VOLUME_DUCK<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// we'll be relatively quiet</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mMediaPlayer<span class="token punctuation">.</span><span class="token function">setVolume</span><span class="token punctuation">(</span>VOLUME_NORMAL<span class="token punctuation">,</span> VOLUME_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// we can be loud again</span>
            <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">// else do something for remote client.</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">// If we were playing when we lost focus, we need to resume playing.</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>mPlayOnFocusGain<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mMediaPlayer <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mMediaPlayer<span class="token punctuation">.</span><span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                LogHelper<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"configMediaPlayerState startMediaPlayer. seeking to "</span><span class="token punctuation">,</span>
                        mCurrentPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mCurrentPosition <span class="token operator">==</span> mMediaPlayer<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    mMediaPlayer<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mState <span class="token operator">=</span> PlaybackState<span class="token punctuation">.</span>STATE_PLAYING<span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    mMediaPlayer<span class="token punctuation">.</span><span class="token function">seekTo</span><span class="token punctuation">(</span>mCurrentPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    mState <span class="token operator">=</span> PlaybackState<span class="token punctuation">.</span>STATE_BUFFERING<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            mPlayOnFocusGain <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mCallback <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mCallback<span class="token punctuation">.</span><span class="token function">onPlaybackStatusChanged</span><span class="token punctuation">(</span>mState<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

<h3 id="puttingeverythingtogether">Putting everything together</h3>

<p>Putting everything together, we can create a basic play method that takes a <a href="https://developer.android.com/reference/android/media/session/MediaSession.QueueItem.html" target="_blank"><code>QueueItem</code></a> and plays it. Note that we keep track of the source of the media items separately. The custom music provider class handles the mapping from <code>QueueItem</code> ids to music source.  </p>

<pre class=" language-java"><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span>QueueItem item<span class="token punctuation">,</span> <span class="token keyword">boolean</span> reset<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    mPlayOnFocusGain <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// TODO Try to get audio focus</span>
    <span class="token comment" spellcheck="true">// TODO Register for audio noisy receiver</span>

    String mediaId <span class="token operator">=</span> item<span class="token punctuation">.</span><span class="token function">getDescription</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMediaId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">boolean</span> mediaHasChanged <span class="token operator">=</span> <span class="token operator">!</span>TextUtils<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>mediaId<span class="token punctuation">,</span> mCurrentMediaId<span class="token punctuation">)</span> <span class="token operator">||</span> reset<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mediaHasChanged<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mCurrentPosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        mCurrentMediaId <span class="token operator">=</span> mediaId<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>mState <span class="token operator">==</span> PlaybackState<span class="token punctuation">.</span>STATE_PAUSED <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>mediaHasChanged <span class="token operator">&amp;&amp;</span> mMediaPlayer <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Begin playing if we were paused before and the media hasn't changed</span>
        <span class="token function">configMediaPlayerState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// Recreate the media player</span>
        mState <span class="token operator">=</span> PlaybackState<span class="token punctuation">.</span>STATE_STOPPED<span class="token punctuation">;</span>
        <span class="token function">relaxResources</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// release everything except MediaPlayer</span>

        <span class="token comment" spellcheck="true">// Get the source for the music track</span>
        <span class="token comment" spellcheck="true">// TODO Customize this as per your needs</span>
        MediaMetadata track <span class="token operator">=</span> mMusicProvider<span class="token punctuation">.</span><span class="token function">getMusic</span><span class="token punctuation">(</span>mediaId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        String source <span class="token operator">=</span> track<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span>MusicProvider<span class="token punctuation">.</span>CUSTOM_METADATA_TRACK_SOURCE<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token function">createMediaPlayerIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            mState <span class="token operator">=</span> PlaybackState<span class="token punctuation">.</span>STATE_BUFFERING<span class="token punctuation">;</span>

            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setAudioStreamType</span><span class="token punctuation">(</span>AudioManager<span class="token punctuation">.</span>STREAM_MUSIC<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">setDataSource</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// Starts preparing the media player in the background. When</span>
            <span class="token comment" spellcheck="true">// it's done, it will call our OnPreparedListener (that is,</span>
            <span class="token comment" spellcheck="true">// the onPrepared() method on this class, since we set the</span>
            <span class="token comment" spellcheck="true">// listener to 'this'). Until the media player is prepared,</span>
            <span class="token comment" spellcheck="true">// we *cannot* call start() on it!</span>
            mMediaPlayer<span class="token punctuation">.</span><span class="token function">prepareAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment" spellcheck="true">// If we are streaming from the internet, we want to hold a</span>
            <span class="token comment" spellcheck="true">// Wifi lock, which prevents the Wifi radio from going to</span>
            <span class="token comment" spellcheck="true">// sleep while the song is playing.</span>
            mWifiLock<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span>mCallback <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mCallback<span class="token punctuation">.</span><span class="token function">onPlaybackStatusChanged</span><span class="token punctuation">(</span>mState<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            LogHelper<span class="token punctuation">.</span><span class="token function">e</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> ex<span class="token punctuation">,</span> <span class="token string">"Exception playing song"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>mCallback <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                mCallback<span class="token punctuation">.</span><span class="token function">onError</span><span class="token punctuation">(</span>ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

<h3 id="releasingthemediaplayer">Releasing the MediaPlayer</h3>

<p>A MediaPlayer can consume valuable system resources. Therefore, you should always take extra precautions to make sure you are not hanging on to a <code>MediaPlayer</code> instance longer than necessary. When you are done with it, you should always call <code>release()</code> to make sure any system resources allocated to it are properly released.</p>

<pre class=" language-java"><code class=" language-java"><span class="token comment" spellcheck="true">/**
 * Releases resources used by the service for playback. This includes the
 * "foreground service" status, the wake locks and possibly the MediaPlayer.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">relaxResources</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> releaseMediaPlayer<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    mService<span class="token punctuation">.</span><span class="token function">stopForeground</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// stop and release the Media Player, if it's available</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>releaseMediaPlayer <span class="token operator">&amp;&amp;</span> mMediaPlayer <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMediaPlayer<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mMediaPlayer <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">// we can also release the Wifi lock, if we're holding it</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>mWifiLock<span class="token punctuation">.</span><span class="token function">isHeld</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mWifiLock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

<h3 id="wrappingeverythingup">Wrapping everything up</h3>

<p>In order to simplify the handling of MediaPlayer, let's wrap everything that we discussed above into an interface. This interface could then be used wherever we want to play music - be it in a Service to allow playing music in the background (more on this in the next post), or an Activity to play music only while the user is interacting with the application.</p>

<pre class=" language-java"><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Playback</span> <span class="token punctuation">{</span>  
    <span class="token comment" spellcheck="true">/**
     * Start/setup the playback.
     * Resources/listeners would be allocated by implementations.
     */</span>
    <span class="token keyword">void</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Stop the playback. All resources can be de-allocated by implementations here.
     */</span>
    <span class="token keyword">void</span> <span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Set the latest playback state as determined by the caller.
     */</span>
    <span class="token keyword">void</span> <span class="token function">setState</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Get the current {@link android.media.session.PlaybackState#getState()}
     */</span>
    <span class="token keyword">int</span> <span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * @return boolean indicating whether the player is playing or is supposed to be
     * playing when we gain audio focus.
     */</span>
    <span class="token keyword">boolean</span> <span class="token function">isPlaying</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * @return pos if currently playing an item
     */</span>
    <span class="token keyword">int</span> <span class="token function">getCurrentStreamPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * @return duration if currently playing an item
     */</span>
    <span class="token keyword">long</span> <span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Set the current position. Typically used when switching players that are in
     * paused state.
     *
     * @param pos position in the stream
     */</span>
    <span class="token keyword">void</span> <span class="token function">setCurrentStreamPosition</span><span class="token punctuation">(</span><span class="token keyword">int</span> pos<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * @param item to play
     */</span>
    <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span>QueueItem item<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * @param item  to play
     * @param reset true to always start from beginning
     */</span>
    <span class="token keyword">void</span> <span class="token function">play</span><span class="token punctuation">(</span>QueueItem item<span class="token punctuation">,</span> <span class="token keyword">boolean</span> reset<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Pause the current playing item
     */</span>
    <span class="token keyword">void</span> <span class="token function">pause</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">/**
     * Seek to the given position
     */</span>
    <span class="token keyword">void</span> <span class="token function">seekTo</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">interface</span> <span class="token class-name">Callback</span> <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">/**
         * On current music completed.
         */</span>
        <span class="token keyword">void</span> <span class="token function">onCompletion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">/**
         * on Playback status changed
         * Implementations can use this callback to update
         * playback state on the media sessions.
         */</span>
        <span class="token keyword">void</span> <span class="token function">onPlaybackStatusChanged</span><span class="token punctuation">(</span><span class="token keyword">int</span> state<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">/**
         * @param error to be added to the PlaybackState
         */</span>
        <span class="token keyword">void</span> <span class="token function">onError</span><span class="token punctuation">(</span>String error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment" spellcheck="true">/**
     * @param callback to be called
     */</span>
    <span class="token keyword">void</span> <span class="token function">setCallback</span><span class="token punctuation">(</span>Callback callback<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

<h3 id="bonus">Bonus</h3>

<p>Here's a sample implementation of the MusicProvider class to map the <code>QueueItem</code> to the actual music source url. </p>

<pre class=" language-java"><code class=" language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MusicProvider</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String CUSTOM_METADATA_TRACK_SOURCE <span class="token operator">=</span> <span class="token string">"__SOURCE__"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> Context mContext<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> Realm mRealm<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">MusicProvider</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> Realm realm<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
        mRealm <span class="token operator">=</span> realm<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> AlbumFile <span class="token function">getMusicFile</span><span class="token punctuation">(</span>String musicId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mRealm<span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span>Track<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equalTo</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">parseInt</span><span class="token punctuation">(</span>musicId<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findFirst</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> MediaMetadata <span class="token function">getMusic</span><span class="token punctuation">(</span>String musicId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">getMusicFile</span><span class="token punctuation">(</span>musicId<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMediaMetadata</span><span class="token punctuation">(</span>mContext<span class="token punctuation">,</span> mRealm<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>

<p>Our <code>Track</code> class contains all details about the music track and creates the MediaMetadata as follows: </p>

<pre class=" language-java"><code class=" language-java"><span class="token keyword">public</span> MediaMetadata <span class="token function">getMediaMetadata</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> Realm realm<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
    Album album <span class="token operator">=</span> <span class="token function">getAlbum</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> realm<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// Get the album this track belongs to</span>
    List<span class="token operator">&lt;</span>AlbumFile<span class="token operator">&gt;</span> allTracks <span class="token operator">=</span> album<span class="token punctuation">.</span><span class="token function">getTracks</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MediaMetadata<span class="token punctuation">.</span>Builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_MEDIA_ID<span class="token punctuation">,</span> Integer<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>MusicProvider<span class="token punctuation">.</span>CUSTOM_METADATA_TRACK_SOURCE<span class="token punctuation">,</span> <span class="token function">getUrl</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> realm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_ALBUM<span class="token punctuation">,</span> album<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_ARTIST<span class="token punctuation">,</span> album<span class="token punctuation">.</span><span class="token function">getArtist</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putLong</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_DURATION<span class="token punctuation">,</span> Float<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token function">getDuration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">longValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_ALBUM_ART_URI<span class="token punctuation">,</span> album<span class="token punctuation">.</span><span class="token function">getImagePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putString</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_TITLE<span class="token punctuation">,</span> <span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putLong</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_TRACK_NUMBER<span class="token punctuation">,</span> allTracks<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">putLong</span><span class="token punctuation">(</span>MediaMetadata<span class="token punctuation">.</span>METADATA_KEY_NUM_TRACKS<span class="token punctuation">,</span> allTracks<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>

<p>I have had far too many requests for the source code and the reason I am not putting it up is that as all source code, it requires constant maintenance and I don't have enough time to manage this. Secondly, I have seen far too many people picking up the source code and putting it as is into the app which floods the already sub-par app market with low-quality apps aimed only for ad revenue. There is already a good, well-maintained music player source code maintained by <a href="https://github.com/googlesamples/android-UniversalMusicPlayer" target="_blank">Google</a> if someone really needs it. Otherwise, if you need professional help, please feel free to shoot me <a href="mailto:diwakar.sapan@gmail.com">an email</a>.</p>

<p><em>This is the first tutorial in the series <a href="http://sapandiwakar.in/building-a-music-player-app-for-android/" target="_blank"><strong>Building a Music Player App for Android</strong></a>. Stay tuned for more tutorials in this series! Take me to <a href="http://sapandiwakar.in/building-a-music-player-app-for-android-2/" target="_blank">next tutorial</a></em></p>
        </section>

        <footer class="post">

                <section class="author">
                    <h4>Sapan Diwakar</h4>
                    <p>Mobile and Web developer. Traveller. </p>
                </section>

            <section class="share">
                <h4>Share this post</h4>
                <a class="twitter" href="https://twitter.com/share?text=Media%20Player%20basics%20for%20Android&amp;url=http://sapandiwakar.in/media-player-basics-for-android/" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(this.href, &#39;twitter-share&#39;, &#39;width=550,height=235&#39;);return false;" target="_blank">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://sapandiwakar.in/media-player-basics-for-android/" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(this.href, &#39;facebook-share&#39;,&#39;width=580,height=296&#39;);return false;" target="_blank">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="google" href="https://plus.google.com/share?url=http://sapandiwakar.in/media-player-basics-for-android/" onclick="if (!window.__cfRLUnblockHandlers) return false; window.open(this.href, &#39;google-plus-share&#39;, &#39;width=490,height=530&#39;);return false;" target="_blank">
                    <span class="hidden">Google+</span>
                </a>
            </section>

        </footer>


    </article>

    <div id="disqus_thread"><iframe id="dsq-app8371" name="dsq-app8371" allowtransparency="true" frameborder="0" scrolling="no" tabindex="0" title="Disqus" width="100%" src="./Media Player basics for Android_files/saved_resource.html" style="width: 1px !important; min-width: 100% !important; border: none !important; overflow: hidden !important; height: 965px !important;" horizontalscrolling="no" verticalscrolling="no"></iframe></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'sapandiwakar'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>

</main>

  </section>
  <script type="text/javascript" src="./Media Player basics for Android_files/prism.min.js.download"></script>
<script type="text/javascript" src="./Media Player basics for Android_files/prism-kotlin.min.js.download"></script>
<script type="text/javascript" src="./Media Player basics for Android_files/prism-swift.min.js.download"></script>
<script type="text/javascript" src="./Media Player basics for Android_files/prism-java.min.js.download"></script>
<script type="text/javascript" src="./Media Player basics for Android_files/prism-javascript.min.js.download"></script>
<script type="text/javascript" src="./Media Player basics for Android_files/prism-clike.min.js.download"></script>
<script type="text/javascript" src="./Media Player basics for Android_files/prism-c.min.js.download"></script>
<script type="text/javascript" src="./Media Player basics for Android_files/prism-objectivec.js.download"></script>


<iframe style="display: none;" src="./Media Player basics for Android_files/saved_resource(1).html"></iframe></body></html>