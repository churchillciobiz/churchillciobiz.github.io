<!DOCTYPE html>
<html>
    <head>
        <style>
            div,body{
            margin:0;
            padding:0;
        }
            .item-image{
            width:130px;
            height:130px;
            margin-bottom: 80px;
        }
        .item-image img{
            width:100%;
        }
        .item-image .action-buttons button{
            padding: 7px 9px;
            border: none;
            border-radius: 35px;
            background: #b1ff49;
            color: #fff;
            font-size: 12px;
            font-weight: 500;
            box-shadow: 1px 1px 0 rgba(0,0,0,0.2), 0 16px 15px -16px #5ad20f, inset 0 0 25px rgba(0,0,0,0.05);
        }
        #showcase{
            display:flex;
            flex-wrap: wrap;
        }
        </style>
        
   </head>
   <body>
        <div id="showcase">
            
            
        </div>
        <script>
            function _(x) { return document.getElementById(x) };
			function hasClass(element, className){
				return element.className.split(" ").indexOf(className) > -1;
			}
			function addClass(element, className){
				if(hasClass(element, className)){
					return element.classList;
				} else {
					return element.classList.add(className);
				}
			}
			function removeClass(element, className){
				if(hasClass(element, className)){
					return element.classList.remove(className);
				}else{
					return element.classList;
				}
			}
            const CART = {
	KEY: 'bjasopticajdbakhadjsk71',
	contents: [],
	init() {
		//check localStorage and initialize the contents of CART.contentslet 
		let _contents = localStorage.getItem(CART.KEY); 
		if(_contents) {
			CART.contents = JSON.parse(_contents);
		}else {
			CART.contents = [];
			CART.sync();
		}
	},
	async sync() {
		let _cart = JSON.stringify(CART.contents);
		await localStorage.setItem(CART.KEY, _cart);
	},
	find(id) {
		console.log(id);
		//find an item in the cart by its id
		let match = CART.contents.filter(item => {
			if(item.itemId == id) 
				return true;
		});
		if(match && match[0])
			return match[0];
	},
	addItem(id, categoryId) {

		if(CART.find(id)) {
			return 0;//CART.increase(id, 1);
			console.log(PAGEPRODUCTS);
		}else{
			let arr = PAGEPRODUCTS.filter(product=> {
				if(product.itemId == id) {
					return true;
				}
			});
			console.log(arr);
		if(arr && arr[0]) {
			let obj = {
				itemId: arr[0].itemId,
				itemName: arr[0].itemName,
				itemPrice: arr[0].itemPrice,
				imageUrl: arr[0].imageUrl,
				quantity: 1,
				itemCategoryId: categoryId,
			};
			CART.contents.push(obj);
			//update localStorage
			
			CART.sync();
			console.log(CART.contents);
		}else {
			//product id does not exist in products data
			console.error("invalid product");
		}
	}
	},
	filter(array, test){
			var passed = [];
			for(var i = 0; i< array.length; i++){
				if(test(array[i])){
					passed.push(array[i]);
				}
			}
			return passed;
		
	},
	remove(id) {
		//remove an item entirely from CART.contents based on its id 
		CART.contents = CART.filter(CART.contents, (items)=> {
			return items.itemId != id;
		})
		_(id).innerHTML = "Add to Cart";
		//update localStorage
		console.log(CART.contents);
		CART.sync();
	},
	empty() {
		//empty whole cart
		CART.contents = [];
		//update localStorage
		CART.sync();
	},
}
console.log(getAllUrlParams(window.location.href));
            let urldata = getAllUrlParams(window.location.href);
var data = '';
		if(urldata.itemtype=="polo"){
			data = [
					{"itemId": "524428f621d601b","itemName": "Miltonsladiso","itemPrice":4400,"imageUrl":"small_Mercedes petronas shirt.jpg"},
					{"itemId": "5d4428f621d601c","itemName": "Aviators","itemPrice":1400,"imageUrl":"small_Mercedes petronas shirt.jpg"},
                    {"itemId": "524428f621d601b","itemName": "Dino","itemPrice":4400,"imageUrl":"small_Mercedes petronas shirt.jpg"},
					{"itemId": "5d4428f621d601c","itemName": "Misfit","itemPrice":1400,"imageUrl":"small_Mercedes petronas shirt.jpg"}
					]
		}else if(urldata.itemtype=="nike"){
			data = [
					{"itemId": "524428f621d601j","itemName": "Miltons","itemPrice":2400,"imageUrl":"https://image.ebdcdn.com/image/upload/c_fill,e_sharpen:70,f_auto,h_300,q_auto:good,w_600/v1/product/frame/white/pl5086_3.jpg"},
					{"itemId": "5d4428f621d601k","itemName": "Aviators","itemPrice":3400,"imageUrl":"https://s7d5.scene7.com/is/image/Glasses/713132376980_shad_qt?$g-thumbnail-plp$"}
					]

		}
        let PAGEPRODUCTS = [];
        function showPageProducts(cart) {
			var cartJson = JSON.parse(cart);
			const cartLength = cartJson.length;
			console.log(cartJson);
			//console.log(cartLength);
			console.log(cartLength);
			
						PAGEPRODUCTS = data;
					   _("showcase").innerHTML = PAGEPRODUCTS.map(function(item){
							
								for(var i=0; i<cartLength; i++){
									if(item.itemId == cartJson[i].itemId) {
										return  `<div class='item-image'>
													<img src="${cartJson[i].imageUrl}" alt="${cartJson[i].itemName}" class="user-1">
													<div class="action-buttons">
														<div class="price">${cartJson[i].itemName}</div>
														<div class="price">Kshs ${cartJson[i].itemPrice}</div>
														<button class="view-item">View</button>
														<button class="add-to-cart check-status" data-id=${cartJson[i].itemId} id=${cartJson[i].itemId}>In Cart</button>
													</div>
												</div>`;
											}
								}	


									return	`<div class='item-image'>
												<img src="${item.imageUrl}" alt="${item.itemName}" class="user-1">
												<div class="action-buttons">
													<div class="name">${item.itemName}</div>
													<div class="price">Kshs ${item.itemPrice}</div>
													<button class="view-item">View</button>
													<button class="add-to-cart check-status" data-id=${item.itemId} id=${item.itemId}>Add to Cart</button>
												</div>
											</div>`;
									
								});
		            
		}
             function getAllUrlParams(url){
                var queryString = url ? url.split("?")[1] : window.location.search.splice(1);
                var obj = {}
                if(queryString){
                    queryString = queryString.split("#")[0]
                    var arr = queryString.split("&");

                    for(var i = 0; i<arr.length; i++){
                        var a = arr[i].split("=");
                        var paramName = a[0];

                        var paramValue = typeof(a[1]) === 'undefined' ? true: a[1];

                        paramName = paramName.toLowerCase();
                        if(typeof paramValue === 'string') paramValue = paramValue.toLowerCase()

                        if(paramName.match(/\[(\d+)?\]$/)){
                            var key = paramName.replace(/\[(\d+)?\]/, '');
                            if(! obj[key]) obj[key] = [];

                            if(paramName.match(/\[\d+\]$/)){
                                var index = /\[(\d+)\]/.exec(paramName)[1];

                                obj[key][index]  = paramValue;
                            } else {
                                obj[key].push(paramValue);
                            }
                        }else {
                            if(! obj[paramName]) {
                                obj[paramName] = paramValue;
                            } else if(obj[paramName] && typeof obj[paramName] == 'string'){
                                obj[paramName] = [obj[paramName]];
                                obj[paramName].push(paramValue);
                            } else {
                                obj[paramName].push(paramValue);
                            }
                        }
                    }
                }
                return obj;
            }
            
            
            window.onload = function(){
			var allButtons = document.getElementsByClassName("button");
        	var incarts = localStorage.getItem(CART.KEY);
        	var incartsJson = JSON.parse(incarts);

			window.addEventListener("click", function(e){
		        if(hasClass(e.target, "check-status")){
		            console.log(e.target.id)
		            if(CART.find(e.target.id)){
		                console.log("item in cart");
		                Confirm.render('remove-cart-item', 'Remove from Cart',e.target.id);
		            }else {
		                console.log("item not in cart");
		                _(e.target.id).innerHTML = "In Cart";
		                CART.addItem(e.target.id, urldata.categoryid);
		               //_("items-number").innerHTML = CART.contents.length;
		                console.log(CART.contents.length);
		            }   
		        }
		    }, false)
		    //get the cart items from localStorage
    		CART.init();
    		//_("items-number").innerHTML = CART.contents.length;
    		showPageProducts(incarts);  
    		//getHref();
		}
        </script>
   </body> 
</html>